# Инструкция по Docker-деплою

Мы перевели проект на полную Docker-архитектуру. Теперь и приложение, и база данных, и мониторинг запускаются одной командой.

## Что изменилось?
1.  **Dockerfile**: Добавлен файл для сборки приложения (Backend + Frontend).
2.  **docker-compose.yml**: Обновлен для запуска всего стека (App, DB, Prometheus, Grafana).
3.  **deploy.sh**: Скрипт для автоматического обновления и перезапуска.

## Как задеплоить (обновить) проект

### 1. Сделайте скрипт исполняемым (один раз)
```bash
chmod +x deploy.sh
```

### 2. Запустите деплой
```bash
./deploy.sh
```

Этот скрипт автоматически:
1.  Остановит старый systemd-сервис (если он работал).
2.  Скачает обновления из git.
3.  Пересоберет и перезапустит Docker-контейнеры.
4.  Применит миграции базы данных.

## Доступ к сервисам

-   **Приложение**: https://novel-cloudtech.com:7443/
-   **Grafana**: https://novel-cloudtech.com:7443/grafana/
    -   Логин: `admin`
    -   Пароль: `admin` (смените при входе)

## Управление вручную (если нужно)

-   **Посмотреть логи приложения**:
    ```bash
    docker compose logs -f app
    ```
-   **Посмотреть статус контейнеров**:
    ```bash
    docker compose ps
    ```
-   **Перезапустить только приложение**:
    ```bash
    docker compose restart app
    ```

## Структура контейнеров
-   `leetcode-tracker-app`: Ваше FastAPI приложение.
-   `leetcode-tracker-db`: PostgreSQL база данных.
-   `prometheus`: Сбор метрик.
-   `grafana`: Визуализация метрик.
-   `node_exporter`: Метрики хоста (CPU, RAM).
-   `cadvisor`: Метрики контейнеров.
